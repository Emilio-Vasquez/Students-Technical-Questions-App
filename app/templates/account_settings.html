{% extends "base.html" %}

{% block title %}Account Settings - Technical Questions App{% endblock %}

{% block content %}
<div class="account-settings-container">
    <h2>Account Settings</h2>

    <div class="account-card">
        <h3>Profile Information</h3>
        <p><strong>Username:</strong> {{ username }}</p>
        <p><strong>Email:</strong> {{ email }}
            {% if is_verified %}
                <span style="color: green; font-weight: bold; margin-left: 10px;">✔ Verified</span>
            {% else %}
                <span style="color: red; font-weight: bold; margin-left: 10px;">✖ Not Verified</span>

                <!-- Send Code Form -->
                <form method="POST" id="send-code-form" style="display: inline;">
                    <input type="hidden" name="action" value="verify_email">
                    <button type="submit" class="small-btn action-btn">Send Code</button>
                </form>

                <!-- Hidden initially -->
                <div id="code-entry" style="display: none; margin-top: 10px;">
                    <form method="POST" id="verify-code-form">
                        <input type="hidden" name="action" value="submit_verification_code">
                        <label for="verification_code">Enter Code:</label>
                        <input type="text" name="verification_code" required>
                        <button type="submit" class="small-btn action-btn">Verify</button>
                    </form>
                </div>
            {% endif %}
        </p>

        {% if flash_message %}
            <div class="flash">{{ flash_message }}</div>
        {% endif %}

        <p><strong>Phone:</strong> {{ phone if phone else "Not set" }}
            <button id="toggle-phone-btn" class="small-btn action-btn">Add/Update</button>
        </p>
    </div>

    <div class="account-card">
        <button id="toggle-password-btn" class="primary-btn">Change Password</button>
        <form id="password-form" method="post" action="{{ url_for('main.account_settings') }}" class="account-form">
            <h3>Change Password</h3>
            <div>
                <label for="current_password">Current Password:</label>
                <input type="password" name="current_password" id="current_password" required>
            </div>
            <div>
                <label for="new_password">New Password:</label>
                <input type="password" name="new_password" id="new_password" required>
            </div>
            <div>
                <label for="confirm_new_password">Confirm New Password:</label>
                <input type="password" name="confirm_new_password" id="confirm_new_password" required>
            </div>
            <button type="submit" name="action" value="change_password">Update Password</button>
        </form>
    </div>

    <div class="account-card">
        <div id="toggle-phone-btn" class="section-toggle">
            <h3>Update Phone</h3>
        </div>
        <form id="phone-form" method="post" action="{{ url_for('main.account_settings') }}" class="account-form">
            <h3>Phone Number Section</h3>
            <div>
                <label for="phone">Phone Number:</label>
                <input type="text" name="phone" id="phone" required placeholder="+1 555-123-4567">
            </div>
            <button type="submit" name="action" value="update_phone">Save Phone Number</button>
        </form>
    </div>

    <div class="account-card progress-card">
        <h3>Your Progress</h3>
        <div class="progress-category">
            <span>Computer Science</span>
            <div class="progress-bar">
                <div class="progress-fill cs-fill" style="width: {{ (progress.cs_completed / totals.cs * 100) if totals.cs else 0 }}%"></div>
            </div>
            <span class="progress-count">{{ progress.cs_completed }}/{{ totals.cs }}</span>
        </div>
        <div class="progress-category">
            <span>Data Science</span>
            <div class="progress-bar">
                <div class="progress-fill ds-fill"
                    style="width: {{ ((progress.cs_completed + progress.db_completed) / (totals.cs + totals.db) * 100) if (totals.cs + totals.db) else 0 }}%">
                </div>
            </div>
            <span class="progress-count">{{ progress.cs_completed + progress.db_completed }}/{{ totals.cs + totals.db }}</span>
        </div>
        <div class="progress-category">
            <span>Databases</span>
            <div class="progress-bar">
                <div class="progress-fill db-fill" style="width: {{ (progress.db_completed / totals.db * 100) if totals.db else 0 }}%"></div>
            </div>
            <span class="progress-count">{{ progress.db_completed }}/{{ totals.db }}</span>
        </div>
    </div>
</div>

<script src="{{ url_for('static', filename='js/account_settings.js') }}"></script>

{% endblock %}
